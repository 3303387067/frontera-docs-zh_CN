

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Fine tuning of Frontera cluster &mdash; Frontera 0.6.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Frontera 0.6.0 documentation" href="../index.html"/>
        <link rel="next" title="DNS Service" href="dns-service.html"/>
        <link rel="prev" title="Recording a Scrapy crawl" href="scrapy-recorder.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Frontera
          

          
          </a>

          
            
            
              <div class="version">
                0.6
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Frontera at a glance</a></li>
<li class="toctree-l1"><a class="reference internal" href="run-modes.html">Run modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick-start-single.html">Quick start single process</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick-start-distributed.html">Quick start distributed mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="cluster-setup.html">Cluster setup guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="frontier-objects.html">Frontier objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="frontier-middlewares.html">Middlewares</a></li>
<li class="toctree-l1"><a class="reference internal" href="frontier-canonicalsolvers.html">Canonical URL Solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="frontier-backends.html">Backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="message_bus.html">Message bus</a></li>
<li class="toctree-l1"><a class="reference internal" href="own_crawling_strategy.html">Crawling strategy</a></li>
<li class="toctree-l1"><a class="reference internal" href="scrapy-integration.html">Using the Frontier with Scrapy</a></li>
<li class="toctree-l1"><a class="reference internal" href="frontera-settings.html">Settings</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="what-is-cf.html">What is a Crawl Frontier?</a></li>
<li class="toctree-l1"><a class="reference internal" href="graph-manager.html">Graph Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="scrapy-recorder.html">Recording a Scrapy crawl</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Fine tuning of Frontera cluster</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#why-crawling-speed-is-so-low">Why crawling speed is so low?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tuning-hbase">Tuning HBase</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tuning-kafka">Tuning Kafka</a></li>
<li class="toctree-l2"><a class="reference internal" href="#flow-control-between-various-components">Flow control between various components</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dns-service.html">DNS Service</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="frontier-api.html">Frontera API</a></li>
<li class="toctree-l1"><a class="reference internal" href="requests-integration.html">Using the Frontier with Requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests.html">Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="loggers.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="frontier-tester.html">Testing a Frontier</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">F.A.Q.</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contribution guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Frontera</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>Fine tuning of Frontera cluster</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/topics/fine-tuning.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="fine-tuning-of-frontera-cluster">
<h1>Fine tuning of Frontera cluster<a class="headerlink" href="#fine-tuning-of-frontera-cluster" title="Permalink to this headline">¶</a></h1>
<div class="section" id="why-crawling-speed-is-so-low">
<h2>Why crawling speed is so low?<a class="headerlink" href="#why-crawling-speed-is-so-low" title="Permalink to this headline">¶</a></h2>
<p>Search for a bottleneck.</p>
<ul class="simple">
<li>All requests are targeted towards a few websites.</li>
<li>DNS resolution (see <a class="reference internal" href="dns-service.html"><span class="doc">DNS Service</span></a> article),</li>
<li><a class="reference internal" href="glossary.html#term-strategy-worker"><span class="xref std std-term">strategy worker</span></a> performance,</li>
<li><a class="reference internal" href="glossary.html#term-db-worker"><span class="xref std std-term">db worker</span></a> batch generation insufficiency.</li>
<li>HBase response times are too high,</li>
<li>Network within cluster is overloaded.</li>
</ul>
</div>
<div class="section" id="tuning-hbase">
<h2>Tuning HBase<a class="headerlink" href="#tuning-hbase" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Increase block cache in HBase.</li>
<li>Put Thrift server on each HBase region server and spread load from SW to Thrift.</li>
<li>Enable Snappy compression (see <a class="reference internal" href="frontera-settings.html#std:setting-HBASE_USE_SNAPPY"><code class="xref std std-setting docutils literal"><span class="pre">HBASE_USE_SNAPPY</span></code></a>).</li>
</ul>
</div>
<div class="section" id="tuning-kafka">
<h2>Tuning Kafka<a class="headerlink" href="#tuning-kafka" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Decrease the log size to minimum and optimize the system to avoid storing in Kafka huge volumes of data. Once data
was written it should be consumed as fast as possible.</li>
<li>Use SSD or even RAM storage for Kafka logs,</li>
<li>Enable Snappy compression for Kafka.</li>
</ul>
</div>
<div class="section" id="flow-control-between-various-components">
<h2>Flow control between various components<a class="headerlink" href="#flow-control-between-various-components" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="frontera-settings.html#std:setting-MAX_NEXT_REQUESTS"><code class="xref std std-setting docutils literal"><span class="pre">MAX_NEXT_REQUESTS</span></code></a> is used for controlling the batch size. In spiders config it controls how much items
will be consumed per one <code class="xref py py-attr docutils literal"><span class="pre">get_next_requests</span></code> call. At
the same time in DB worker config it sets count of items to generate per partition. When setting these parameters keep
in mind:</p>
<ul class="simple">
<li>DB worker and spider values have to be consistent to avoid overloading of message bus and loosing messages. In other
words, DB worker have to produce slightly more than consumed by spiders, because the spider should still be able to
fetch new pages even though the DB worker has not pushed a new batch yet.</li>
<li>Spider consumption rate depends on many factors: internet connection latency, amount of spider
parsing/scraping work, delays and auto throttling settings, usage of proxies, etc.</li>
<li>Keep spider queue always full to prevent spider idling.</li>
<li>General recommendation is to set DB worker value 2-4 times bigger than spiders.</li>
<li>Batch size shouldn&#8217;t be big to not generate too much load on backend, and allow system quickly react on queue changes.</li>
<li>Watch out warnings about lost messages.</li>
</ul>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="dns-service.html" class="btn btn-neutral float-right" title="DNS Service" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="scrapy-recorder.html" class="btn btn-neutral" title="Recording a Scrapy crawl" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014-2016, Frontera authors.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.6.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>